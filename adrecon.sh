#!/bin/bash

cible=$1

if [ ! -d "resultats" ];then
    mkdir resultats
fi
if [ ! -d "resultats/adrecon.txt" ];then
    touch resultats/adrecon.txt
fi

echo "[*] DHCP Checking..."
nmap --script broadcast-dhcp-discover >> resultats/adrecon.txt

echo "[*] DNS checking..."
nmap --script dns-srv-enum --script-args dns-srv-enum.domain=$cible >> resultats/adrecon.txt

echo "[*] Disvovering DNS nameservers..."
nmap -v -sV -p 53 $cible/$mask >> resultats/adrecon.txt
nmap -v -sV -sU -p 53 $cible/$mask >> resultats/adrecon.txt

echo "[*] Reverse lookups PTR"
dnsrecon -r $range -n $cible >> resultats/adrecon.txt

echo "[*] nbt-ns scanning..."
nbtscan -r $cible/$mask >> resultats/adrecon.txt
nmblookup -A $cible >> resultats/adrecon.txt

echo "[*] Port scanning..."
nmap -sS -n --open -p 88,389 $cible >> resultats/adrecon.txt

echo "[*] ldap checking..."
impacket-ntlmrelayx -t "ldap://$cible" --dump-adcs --dump-laps --dump-gmsa >> resultats/adrecon.txt
windapsearch --dc $cible --module users >> resultats/adrecon.txt
windapsearch --dc $cible --module metadata >> resultats/adrecon.txt

echo "[*] Looking for exposed rpc services..."
impacket-rpcdump -port 135 $cible >> resultats/adrecon.txt
impacket-rpcdump -port 593 $cible >> resultats/adrecon.txt

echo "[*] enum4linux checking..."
enum4linux -A $cible >> resultats/adrecon.txt
