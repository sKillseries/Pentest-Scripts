#!/usr/bin/python3

#############################################################################################################################
# author: sKillseries
# Ce script permet d'automatiser la phase découverte d'hôte et a pour but d'améliorer mes méthodologies en termes de pentest
#############################################################################################################################

import os

def discoveringhosts():
    print("Attention il s'agit là de découverte d'hôtes active et non passive !")
    print("""
Quelle méthode ou outils voulez utilisez ?
> 1: ARP discovery
> 2: NBT discovery
> 3: IPv6
    """)
    choix = input("Veuillez sélectionner une option: ")
    if choix == "1":
        print("""
Quel outil voulez utilisez ?
> 1: nmap
> 2: netdiscover
        """)
        option = input("Veuillez sélectionner l'outil désiré: ")
        if option == "1":
            os.system(f"nmap -sn {target} > {enterprise}/discoveringhosts.txt")
            print(f"Le résulat a été enregistré dans le fichier discoveringhosts.txt situé dans le répertoire {enterprise}")
            proceed()
        elif option == "2":
            os.system(f"netdiscover -r {target} > {enterprise}/discoveringhosts.txt")
            print(f"Le résulat a été enregistré dans le fichier discoveringhosts.txt situé dans le répertoire {enterprise}")
            proceed()
        else:
            print("Je n'ai pas compris votre choix veuillez sélectionner une des options")
            discoveringhosts()
    elif choix == "2":
        os.system(f"nbtscan -r {target}/{cidr} > {entreprise}/discoveringhosts.txt")
        print(f"Le résulat a été enregistré dans le fichier discoveringhosts.txt situé dans le répertoire {enterprise}")
        proceed()
    elif choix == "3":
        iface = input("Veuillez saisir l'IFACE: ")
        os.system(f"alive6 {iface} > {enterprise}/discoveringhosts.txt")
        print(f"Le résulat a été enregistré dans le fichier discoveringhosts.txt situé dans le répertoire {enterprise}")
        proceed()

def sctpportdiscovery():
    os.system(f"nmap -T4 -sY -n --open -Pn {target}/{cidr} > {enterprise}/sctpportdiscovery.txt")
    print(f"Le résultat a été enregistré dans le fichier sctpportdiscovery.txt situé dans le répertoire {enterprise}")
    proceed()

def udpportdiscovery():
    os.system(f"nmap -sU -sV --version-intensity 0 -F -n {target}/{cidr} > {enterprise}/udpportdiscovery.txt")
    print(f"Le résultat a été enregistré dans le fichier udpportdiscovery.txt situé dans le répertoire {enterprise}")
    proceed()

def httpportdiscovery():
    os.system(f"masscan -p80,443,8000-8100,8443,8080 {target}/{cidr} > {enterprise}/httpportdiscovery.txt")
    print(f"Le résultat a été enregistré dans le fichier httpportdiscovery.txt situé dans le répertoire {enterprise}")
    proceed()

def tcpportdiscovery():
    os.system(f"masscan -p20,21-23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080 {target}/{cidr} > {enterprise}/tcpportdiscovery.txt")
    print(f"Le résultat a été enregistré dans le fichier tcpportdiscovery.txt situé dans le répertoire {enterprise}")
    proceed()

def icmp():
    print("""
Avec quel outil voulez vous faire une requête ICMP ?
> 1: fping
> 2: nmap
> q: Quitter
    """)
    choix = input("Veuillez sélectionner une option: ")
    if choix == "1":
        os.system(f"fping -g {target}/{cidr} > {enterprise}/icmp.txt")
        print(f"Le résultat a été enregistré dans le fichier icmp.txt situé dans le répertoire {enterprise} \n")
        proceed()
    elif choix == "2":
        os.system(f"nmap -PEPM -sP -vvv -n {target}/{cidr} > {enterprise}/icmp.txt")
        print(f"Le résultat a été enregistré dans le fichier icmp.txt situé dans le répertoire {enterprise} \n")
        proceed()
    elif choix == "q":
        print("fermeture du programme")
        exit(0)
    else:
        print("Je n'ai pas compris votre choix veuillez sélectionner une des options")
        icmp()

def proceed():
    proceed = input("Voulez-vous continuer ? Y/N: ")
    if proceed == "y":
        menu()
    elif proceed == "Y":
        menu()
    elif proceed == "N":
        print("fermeture du programme")
        exit(0)
    elif proceed == "n":
        print("fermeture du programme")
        exit(0)
    else:
        print("Je n'ai pas compris votre demande veuillez sélectionner une des options")
        proceed()

def menu():
    print("""
Que voulez faire ?
> 1: ICMP
> 2: TCP Port Discovery
> 3: HTTP Port Discovery
> 4: UDP Port Discovery
> 5: SCTP Port Discovery
> 6: Discovering hosts
> q: Quitter
    """)
    choix = input("Veullez sélectionner une option: ")
    if choix == "1":
        icmp()
    elif choix == "2":
        tcpportdiscovery()
    elif choix == "3":
        httpportdiscovery()
    elif choix == "4":
        udpportdiscovery()
    elif choix == "5":
        sctpportdiscovery()
    elif choix == "6":
        discoveringhosts()
    elif choix == "q":
        print("Fermeture du programme")
        exit(0)
    else:
        print("Veuillez sélectionner une option présente dans la liste")
        menu()

def main():
    global enterprise
    global target
    global cidr
    enterprise = input("Quel est le nom de l'entreprise que vous soouhaitez audité ?: ")
    target = input("Entrez l'adresse IP réseau de la cible: ")
    cidr = input("Veuillez saisir une range (masque sous la forme cidr): ")
    os.makedirs(enterprise, exist_ok=True)
    print(f"Le répertoire {enterprise} a été créé")
    menu()

if __name__ == '__main__':
    main()