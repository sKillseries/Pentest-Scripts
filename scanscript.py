#!/usr/bin/python3

#############################################################################################################################
# author: sKillseries
# Ce script permet d'automatiser la phase scan d'hôte et a pour but d'améliorer mes méthodologies en termes de pentest
#############################################################################################################################

import os
import subprocess
from termcolor import colored

def sctp_scan(target, enterprise):
    print("""
> 1: nmap SCTP FastScan
> 2: nmap SCTP AllScan
    """)
    choix = input("Veuillez sélectionner une option: ")
    if choix == "1":
        subprocess.run(["nmap", "-T4", "-sY", "-n", "-oA", f"{enterprise}/SCTP_FastScan", target])
        print(colored(f"Le résultat a été enregistré dans le fichier SCTPFastScan situé dans le répertoire {enterprise}", 'blue'))
    elif choix == "2":
        subprocess.run(["nmap", "-T4", "-p-", "-sY", "-sV", "-sC", "-F", "-n", "-oA", f"{enterprise}/SCTP_AllScan", target])
        print(colored(f"Le résultat a été enregistré dans le fichier SCTPAllScan situé dans le répertoire {enterprise}", 'blue'))
    else:
        print(colored("Je n'ai pas compris votre demande. Veuillez sélectionner une des options.", 'yellow'))
        sctp_scan(target, enterprise)

def udp_scan(target, enterprise):
    print("""
> 1: nmap fast check (100 port udp les plus commun)
> 2: nmap check (100 port udp les plus commun)
> 3: nmap fast (top 1000 ports udp)
    """)
    choix = input("Veuillez sélectionner une option: ")
    if choix == "1":
        subprocess.run(["nmap", "-sU", "-sV", "--version-intensity", "0", "-n", "-F", "-T4", "-oA", f"{enterprise}/UDP_Fastcheck", target])
        print(colored(f"Le résultat a été enregistré dans le fichier udp_nmap.txt situé dans le répertoire {enterprise}", 'blue'))
    elif choix == "2":
        subprocess.run(["nmap", "-sU", "-sV", "-sC", "-n", "-F", "-T4", "-oA", f"{enterprise}/udp_check.txt", target])
        print(colored(f"Le résultat a été enregistré dans le fichier udp_nmap.txt situé dans le répertoire {enterprise}", 'blue'))
    elif choix == "3":
        subprocess.run(["nmap", "-sU", "-sV", "--version-intensity", "0", "-n", "-T4", "-oA", f"{enterprise}/udp_fast.txt", target])
        print(colored(f"Le résultat a été enregistré dans le fichier udp_nmap.txt situé dans le répertoire {enterprise}", 'blue'))
    else:
        print(colored("Je n'ai pas compris votre demande. Veuillez sélectionner une des options."))
        udp_scan(target, enterprise)

def tcp_scan(target, enterprise):
    print("""
Avec quel outil voulez-vous le scan ?
> 1: nmap
> 2: bettercap
> q: Quitter
    """)
    choix = input("Veuillez sélectionner une option: ")
    if choix == "1":
        print("""
Quel type de scan voulez-vous faire ?
> 1: fastscan (1000 ports les plus utilisés)
> 2: fullfastscan (Tous les ports)
> 3: fastscan (sans T4)
        """)
        option = input("Veuillez sélectionner une option: ")
        if option == "1":
            subprocess.run(["nmap", "-sV", "-sC", "-O", "-T4", "-n", "-Pn", "-oA", f"{enterprise}/fastscan", target])
            print(colored(f"Le résultat a été enregistré dans le fichier tcp_nmap.txt situé dans le répertoire {enterprise}", 'blue'))
        elif option == "2":
            subprocess.run(["nmap", "-sV", "-sC", "-O", "-T4", "-n", "-Pn", "-p-", "-oA", f"{enterprise}/fullfastscan", target])
            print(colored(f"Le résultat a été enregistré dans le fichier tcp_nmap.txt situé dans le répertoire {enterprise}", 'blue'))
        elif option == "3":
            subprocess.run(["nmap", "-sV", "-sC", "-O", "-p-", "-n", "-Pn", "-oA", f"{enterprise}/fullscan", target])
            print(colored(f"Le résultat a été enregistré dans le fichier tcp_nmap.txt situé dans le répertoire {enterprise}", 'blue'))
        else:
            print(colored("Je n'ai pas compris votre demande. Veuillez sélectionner une des options.", 'yellow'))
            tcp_scan(target, enterprise)
    elif choix == "2":
        subprocess.run(["syn.scan", target, "1", "10000", ">", f"{enterprise}/tcp_bettercap.txt"])
        print(colored(f"Le résultat a été enregistré dans le fichier tcp_bettercap.txt situé dans le répertoire {enterprise}", 'blue'))
    elif choix.lower() == "q":
        print("Fermeture du programme")
        exit(0)
    else:
        print(colored("Je n'ai pas compris votre demande. Veuillez sélectionner une des options.", 'yellow'))
        tcp_scan(target, enterprise)

def proceed():
    while True:
        proceed = input("Voulez-vous continuer ? Y/N: ")
        if proceed.lower() == "y":
            menu(target, enterprise)
            break
        elif proceed.lower() == "n":
            print("Fermeture du programme")
            exit(0)
        else:
            print(colored("Je n'ai pas compris votre demande. Veuillez sélectionner une des options.", 'yellow'))

def menu(target, enterprise):
    print("""
Que voulez-vous faire ?
> 1: TCP
> 2: UDP
> 3: SCTP
> q: Quitter
    """)
    choix = input("Veuillez sélectionner une option: ")
    if choix == "1":
        tcp_scan(target, enterprise)
    elif choix == "2":
        udp_scan(target, enterprise)
    elif choix == "3":
        sctp_scan(target, enterprise)
    elif choix.lower() == "q":
        print("Fermeture du programme")
        exit(0)
    else:
        print(colored("Veuillez sélectionner une option présente dans la liste.", 'yellow'))
        menu(target, enterprise)

def main():
    enterprise = input("Quel est le nom de l'entreprise que vous souhaitez auditer ?: ")
    target = input("Entrez l'adresse IP hôte cible: ")
    os.makedirs(enterprise, exist_ok=True)
    print(colored(f"Le répertoire {enterprise} a été créé", 'blue'))
    menu(target, enterprise)

if __name__ == '__main__':
    main()