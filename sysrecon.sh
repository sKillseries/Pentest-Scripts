#!/bin/bash

cible=$1

if [ ! -d "resultats" ];then
    mkdir resultats
fi
if [ ! -d "files_to_process" ];then
    mkdir files_to_process
fi
if [ ! -d "resultats/sysrecon.md" ];then
    touch resultats/sysrecon.md
fi

echo "[*] ARP active discovering..."
{
    echo -e "## ARP scan result\n"
    echo '```'
    nmap -sn "$cible"
    echo -e '```\n'
} >> resultats/sysrecon.md

nmap -sn "$cible" -oX files_to_process/sys_arp_nmap_scan.xml

echo "[*] NBT discovering..."
{
    echo -e "## NBT scan result\n"
    echo '```'
    nbtscan -r "$cible"
    echo -e '```\n'
} >> resultats/sysrecon.md

nbtscan -r "$cible" 2>&1 | jq -R -s -c 'split("\n") | {results: .}' > files_to_process/sys_nbtscan.json

echo "[*] ICMP discovering..."
{
    echo -e "## ICMP scan result\n"
    echo '```'
    nmap -PE -PP -PM -sP "$cible"
    echo -e '```\n'
} >> resultats/sysrecon.md

nmap -PE -PP -PM -sP "$cible" -oX files_to_process/sys_icmp_nmap_scan.xml

echo "[*] TCP Port scanning..."
{
    echo -e "## TCP port scan result"
    echo '```'
    nmap -Pn --script vuln -sV -p "0-65535" "$cible"
    echo -e '```\n'
} >> resultats/sysrecon.md

nmap -Pn --script vuln -sV -p "0-65535" "$cible" -oX files_to_process/sys_tcp_nmap_scan.xml

echo "[*] Double Checking Port Scanning..."
{
    echo -e "## masscan result\n"
    echo '```'
    masscan -p0-65535,U:0-65535 --max-rate 100000 "$cible"
    echo -e '```\n'
} >> resultats/sysrecon.md 

masscan -p0-65535,U:0-65535 --max-rate 100000 "$cible" -oJ files_to_process/sys_masscan.json