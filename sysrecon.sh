#!/bin/bash

cible=$1

if [ ! -d "resultats" ];then
    mkdir resultats
fi
if [ ! -d "files_to_process" ];then
    mkdir files_to_process
fi
if [ ! -d "resultats/sysrecon.txt" ];then
    touch resultats/sysrecon.txt
fi

echo "[*] ARP active discovering..."
{
    echo "[#] ARP scan result"
    nmap -sn "$cible"
    echo -e "\n"
} >> resultats/sysrecon.txt

nmap -sn "$cible" -oX files_to_process/sys_arp_nmap_scan.xml

echo "[*] NBT discovering..."
{
    echo "[#] NBT scan result"
    nbtscan -r "$cible"
    echo -e "\n"
} >> resultats/sysrecon.txt

nbtscan -r "$cible" 2>&1 | jq -R -s -c 'split("\n") | {results: .}' > files_to_process/sys_nbtscan.json

echo "[*] ICMP discovering..."
{
    echo "[#] ICMP scan result"
    nmap -PE -PP -PM -sP "$cible"
    echo -e "\n"
} >> resultats/sysrecon.txt

nmap -PE -PP -PM -sP "$cible" -oX files_to_process/sys_icmp_nmap_scan.xml

echo "[*] TCP Port scanning..."
{
    echo "[#] TCP port scan result"
    nmap -Pn --script vuln -sV -p "0-65535" "$cible"
    echo -e "\n"
} >> resultats/sysrecon.txt

nmap -Pn --script vuln -sV -p "0-65535" "$cible" -oX files_to_process/sys_tcp_nmap_scan.xml

echo "[*] Double Checking Port Scanning..."
{
    echo "[#] masscan result"
    masscan -p0-65535,U:0-65535 --max-rate 100000 "$cible"
    echo -e "\n"
} >> resultats/sysrecon.txt 

masscan -p0-65535,U:0-65535 --max-rate 100000 "$cible" -oJ files_to_process/sys_masscan.json