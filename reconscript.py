#!/usr/bin/python3

##########################################################################################################################
# author: sKillseries
# Ce script permet d'automatiser la phase reconnaissance et a pour but d'améliorer mes méthodologies en termes de pentest
###########################################################################################################################

import os

def whois():
    os.system(f"whois {target} > {enterprise}/whois.txt")
    print(f"Le résultat a été enregistré dans le fichier whois.txt situé dans le répertoire {enterprise} \n")
    proceed()

def nslookup():
    print(f"""
    Quel type de scan voulez-vous effectuez ?
    > 1: dns lookup
    > 2: reverse dns lookup
    > 3: (MX) Mail Exchange lookup
    """)
    option = input(f"Votre choix: ")
    if option == "1":
        os.system(f"nslookup {target} > {enterprise}/dns-lookup.txt")
        print(f"Le résultat a été enregistré dans le fichier dns-lookup.txt situé dans le répertoire {enterprise} \n")
        proceed()
    elif option == "2":
        ip = input("Veuillez saisir l'IP cible: ")
        os.system(f"nslookup -type=PTR {ip} > {enterprise}/reverse-dns-lookup.txt")
        print(f"Le résultat a été enregistré dans le fichier reverse-dns-lookup.txt situé dans le répertoire {enterprise} \n")
        proceed()
    elif option == "3":
        os.system(f"nslookup -type=MX {target} > {enterprise}/mx-lookup.txt")
        print(f"Le résultat a été enregistré dans le fichier mx-lookup.txt situé dans le répertoire {enterprise} \n")
        proceed()
    else:
        print("Je n'ai pas compris votre demande veuillez sélectionnez une des options")
        nslookup()

def dig():
    print(f"""
    Quel type de scan voulez-vous effectuez ?
    > 1: SPF
    > 2: Dmarc
    """)
    option = input(f"Votre choix: ")
    if option == "1":
        os.system(f"dig txt {target} > {enterprise}/spf.txt")
        print(f"Le résultat a été enregistré dans le fichier spf.txt situé dans le répertoire {enterprise} \n")
        proceed()
    elif option == "2":
        os.system(f"dig txt _dmarc.{target} > {enterprise}/dmarc.txt")
        print(f"Le résultat a été enregistré dans le fichier dmarc.txt situé dans le répertoire {enterprise} \n")
        proceed()
    else:
        print("Je n'ai pas compris votre demande veuillez sélectionnez une des options")
        dig()

def metagoofil():
    numberresult = input("Entrez le nombre de résultat max: ")
    numberfile = input("Entrez le nombre de fichier désirés: ")
    os.system(f"metagoofil -d {target} -t pdf,doc,xls,ppt,odp,ods,docx,xlsx,pptx -l {numberresult} -n {numberfile} -f {enterprise}/metagoofil.html")
    print(f" Le résultat a été enregistré dans le fichier metagoofil.txt situé dans le répertoire {enterprise} \n")
    proceed()

def theharvester():
    os.system(f"theHarvester -d {target} -b google -f {enterprise}/theHarvester.html")
    print(f"Le résultat a été enregistré dans le fichier theHarvester.html situé dans le répertoire {enterprise}")
    proceed()

def dmitry():
    os.system(f"dmitry -wnse {target} -o {enterprise}/dmitry")
    print(f"Le résultat a été enregistré dans le fichier dmitry.txt situé dans le répertoire {enterprise}")
    proceed()

def proceed():
    proceed = input("Voulez-vous continuez ? Y/N: ")
    if proceed == "y":
        menu()
    elif proceed == "Y":
        menu()
    elif proceed == "N":
        print("fermeture du programme")
        exit(0)
    elif proceed == "n":
        print("fermeture du programme")
        exit(0)
    else:
        print("Je n'ai pas compris votre demande veuillez sélectionnez une des options")
        proceed()

def menu():
    print(
        """
        Que voulez-vous faire ?
        > 1: Whois
        > 2: nslookup
        > 3: dig
        > 4: metagoofil
        > 5: TheHarvester
        > 6: Dmitry
        > q: Quitter
        """
    )
    choix = input("Veuillez sélectionnez une option: ")
    if choix == "1":
        whois()
    elif choix == "2":
        nslookup()
    elif choix == "3":
        dig()
    elif choix == "4":
        metagoofil()
    elif choix == "5":
        theharvester()
    elif choix == "6":
        dmitry()
    elif choix == "q":
        print("fermeture du programme")
        exit(0)
    else:
        print("veuillez sélectionnez une option présente dans la liste")
        menu()

def main():
    global enterprise
    global target
    enterprise = input("Quel est le nom de l'entreprise que vous souhaitez audité ?: ")
    target = input("Entrez le domaine cible: ")
    os.makedirs(enterprise, exist_ok=True)
    print(f"Le répertoire {enterprise} a été créé")
    menu()

if __name__ == '__main__':
    main()